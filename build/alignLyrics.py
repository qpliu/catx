#!/usr/bin/python2

import sys

if len(sys.argv)!=3:
    sys.stderr.write('Usage: python alignLyrics.py notesfile.notes lyricsfile >alignedLyrics\n')
    sys.stderr.write('    notesfile.notes is file generated by lilypond with \\include "event-listener.ly".\n')
    sys.stderr.write('    lyricsfile is file containing lyrics or -- separated by space and no other junk.\n')
    sys.exit(1)

lyrics = []
with open(sys.argv[2]) as f:
    minusminus = False
    for a in f.read().split():
	if a=='--':
	    minusminus = True
	else:
	    if minusminus:
		a = '-'+a
	    lyrics.append('"'+a+'"')
	    minusminus = False;

with open(sys.argv[1]) as f:
    slur = 0
    tie = False
    last_time = None
    for line in f:
	l = line.split()
	if l[1]=='rest':
	    print '-'+l[2]
	elif l[1]=='note':
	    if l[0]==last_time:
		continue
	    last_time = l[0]
	    if slur!=0 or tie:
		lyric = '\\skip'
	    elif lyrics:
		lyric = lyrics[0]
		lyrics = lyrics[1:]
	    else:
		lyric = 'null'
	    print lyric+l[3]
	    tie = False
	elif l[1]=='tie':
	    tie = True
	elif l[1]=='slur':
	    slur += int(l[2])

if lyrics:
    print '%% Extra lyrics %s'%repr(lyrics)
