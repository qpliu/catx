<!doctype html> 
<html>
<head>
<meta charset=UTF-8>
<title id=title>Karaoke Setup</title>
</head>
<form action=index.html>
<span id=settingsInputs></span>
<input type=submit>
</form>
<br>
<form id=chatForm style=visibility:hidden;>
Private Chat With Aarin Robo:
<br>
<div id=chatDiv style=width:100%;height:70vh;overflow-y:scroll;background-color:#ccc;></div>
<div style=width:100%;display:table;>
    <label for=chatInput style=display:table-cell;width:1px;>Chat:</label>
    <input id=chatInput style=display:table-cell;width:100%; type=text>
</div>
</form>
<script src=websocketstuff.js></script>
<script src=settings.js></script>
<script>
    const settings=new Settings();
    settings.makeInputs(document.getElementById("settingsInputs"));
    const chatForm=document.getElementById("chatForm");
    const chatDiv=document.getElementById("chatDiv");
    const websocketStuff=new class extends WebsocketStuff{
	onopen(){
	    super.onopen();
	    chatForm.style.visibility = "visible";
	    websocketStuff.sendChat("help");
	}
	onmessage(event){
	    super.onmessage(event);
	    if (event.data.slice(0,4)=="chat"){
		chatDiv.innerHTML += event.data.slice(4)+"<br>";
		chatDiv.scrollTop = chatDiv.scrollHeight;
	    }
	}
    }();
    chatForm.onsubmit = function(event){
	const chatInput=document.getElementById("chatInput");
	chatDiv.innerHTML += "<font color=pink><b>You</b></font> "+chatInput.value+"<br>";
	chatDiv.scrollTop = chatDiv.scrollHeight;
	websocketStuff.sendChat(chatInput.value);
	chatInput.value = "";
	event.preventDefault();
    };
    websocketStuff.start();
</script>
</html>
