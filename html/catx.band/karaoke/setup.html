<!doctype html> 
<html>
<head>
<meta charset=UTF-8>
<title id=title>Karaoke</title>
</head>
</head>
<form action=index.html>
Common Settings for Snakes or Bouncing Ball:
<br><br>
<span id=span0></span>
<br>
Settings for Snakes:
<br><br>
<span id=span1></span>
<br>
<input type=submit>
</form>
<br>
<form id=chatForm style=visibility:hidden;>
Private Chat With Aarin Robo:
<br>
<div id=chatDiv style=width:90vw;height:70vh;overflow-y:scroll;></div>
<br>
<input id=chatInput style=width:90%; type=text>
<input type=submit>
<form>
<script>
    function make(where,lab,what){
	const whe=document.getElementById(where);
	const label=document.createElement("label");
	label.innerHTML = lab;
	whe.appendChild(label);
	label.for = what;
	const input=document.createElement("input");
	input.type = "text";
	input.name = what;
	let match=window.location.search.match("[?&]"+what+"=([^?&]+)");
	if (match)
	    input.value = match[1];
	whe.appendChild(input);
	whe.appendChild(document.createElement("br"));
    }
    make("span0","Snakes:","snakes");
    make("span0","Delay:","delay");
    make("span1","Time Per Snake:","timePerSnake");
    make("span1","Lowest Note:","lowestNote");
    make("span1","Highest Note:","highestNote");
    make("span1","Transpose:","transpose");
    make("span1","Harmonics To Check:","harmonicsToCheck");
    make("span1","Subharmonics To Check:","subharmonicsToCheck");
    make("span1","FFT Size:","fftSize");
    make("span1","minDecibels:","minDecibels");
    make("span1","maxDecibels:","maxDecibels");
    const websocket=new WebSocket("wss://catx.band/karaoke_websocket");
    const chatForm=document.getElementById("chatForm");
    const chatDiv=document.getElementById("chatDiv");
    chatForm.onsubmit = function(event){
	const chatInput=document.getElementById("chatInput");
	websocket.send("chat"+chatInput.value);
	chatDiv.innerHTML += "<font color=pink><b>You</b></font> "+chatInput.value+"<br>";
	chatDiv.scrollTop = chatDiv.scrollHeight;
	chatInput.value = "";
	event.preventDefault();
    };
    websocket.onopen = function(){
	chatForm.style.visibility = "visible";
    };
    websocket.onmessage = function(event){
	if (event.data.slice(0,4)=="chat"){
	    chatDiv.innerHTML += event.data.slice(4)+"<br>";
	    chatDiv.scrollTop = chatDiv.scrollHeight;
	}
    };
</script>
</html>
